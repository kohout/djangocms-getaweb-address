{% load cmsaddress %}

<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?{% gmaps_api_key %}">
</script>
<script type="text/javascript">
  function initialize() {
    var mapOptions = {
      zoom: 12,
      center: new google.maps.LatLng({{ first.get_lat_long_str }}),
    };
    var map = new google.maps.Map(document.getElementById('map-canvas'),
        mapOptions);
    {% for item in items %}
    var marker{{ forloop.counter0 }} = new google.maps.Marker({
        position: new google.maps.LatLng({{ item.get_lat_long_str }}),
        map: map,
        title: '{{ item.get_name }}'
    });
    var infowindow{{ forloop.counter0 }} = new google.maps.InfoWindow({
      content: '<p>{{ item.formatted_address }}</p><p>{{ item.description }}</p>'
    });
    google.maps.event.addListener(marker{{ forloop.counter0 }}, 'click', function() {
      infowindow{{ forloop.counter0 }}.open(map, marker{{ forloop.counter0 }});
    });
    {% endfor %}
  }

  google.maps.event.addDomListener(window, 'load', initialize);
</script>

<div id="map-canvas" style="width: 100%; height:500px; margin: 0 auto 20px auto;"></div>